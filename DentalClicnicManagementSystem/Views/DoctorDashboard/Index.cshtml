@model CMS.ViewModels.DoctorDashboardViewModel
@inject CMS.Services.ICurrencyService CurrencyService
@{
    ViewData["Title"] = "Doctor Dashboard";
    Layout = "_Layout";
    var currencySymbol = await CurrencyService.GetCurrentCurrencySymbolAsync();
}

<div class="content pb-0">
    <!-- Page Header -->
    <div class="d-flex align-items-sm-center justify-content-between flex-wrap gap-2 mb-4">
        <div>
            <h4 class="fw-bold mb-0">Welcome, Dr. @Model.Doctor.FullName</h4>
        </div>
        <div class="d-flex align-items-center flex-wrap gap-2">
            <a href="javascript:void(0);" class="btn btn-primary d-inline-flex align-items-center"
               data-bs-toggle="offcanvas" data-bs-target="#new_appointment">
                <i class="ti ti-plus me-1"></i>New Appointment
            </a>
            <a href="javascript:void(0);" class="btn btn-outline-white bg-white d-inline-flex align-items-center">
                <i class="ti ti-calendar-time me-1"></i>Schedule Availability
            </a>
        </div>
    </div>

    <!-- Stats Cards Row -->
    <div class="row">
        <!-- Total Appointments -->
        <div class="col-xl-4 d-flex">
            <div class="card shadow-sm flex-fill w-100">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div>
                            <p class="mb-1">Total Appointments</p>
                            <div class="d-flex align-items-center gap-1">
                                <h3 class="fw-bold mb-0" id="total-appointments-today">0</h3>
                                <span class="badge fw-medium bg-success flex-shrink-0" id="total-appointments-change-top">--%</span>
                            </div>
                        </div>
                        <span class="avatar border border-primary text-primary rounded-2 flex-shrink-0">
                            <i class="ti ti-calendar-heart fs-20"></i>
                        </span>
                    </div>
                    <div class="d-flex align-items-end">
                        <div id="s-col-5" class="chart-set"></div>
                        <span class="badge fw-medium badge-soft-success flex-shrink-0 ms-2" id="total-appointments-change-bottom">--%</span>
                        <p class="ms-1 fs-13 text-truncate">in last 7 Days</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Online Consultations -->
        <div class="col-xl-4 d-flex">
            <div class="card shadow-sm flex-fill w-100">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div>
                            <p class="mb-1">Online Consultations</p>
                            <div class="d-flex align-items-center gap-1">
                                <h3 class="fw-bold mb-0" id="online-consultations-today">0</h3>
                                <span class="badge fw-medium bg-danger flex-shrink-0" id="online-consultations-change-top">--%</span>
                            </div>
                        </div>
                        <span class="avatar border border-danger text-danger rounded-2 flex-shrink-0">
                            <i class="ti ti-users fs-20"></i>
                        </span>
                    </div>
                    <div class="d-flex align-items-end">
                        <div id="s-col-6" class="chart-set"></div>
                        <span class="badge fw-medium badge-soft-danger flex-shrink-0 ms-2" id="online-consultations-change-bottom">--%</span>
                        <p class="ms-1 fs-13 text-truncate">in last 7 Days</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cancelled Appointments -->
        <div class="col-xl-4 d-flex">
            <div class="card shadow-sm flex-fill w-100">
                <div class="card-body">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div>
                            <p class="mb-1">Cancelled Appointments</p>
                            <div class="d-flex align-items-center gap-1">
                                <h3 class="fw-bold mb-0" id="cancelled-appointments-today">0</h3>
                                <span class="badge fw-medium bg-success flex-shrink-0" id="cancelled-appointments-change-top">--%</span>
                            </div>
                        </div>
                        <span class="avatar border border-success text-success rounded-2 flex-shrink-0">
                            <i class="ti ti-versions fs-20"></i>
                        </span>
                    </div>
                    <div class="d-flex align-items-end">
                        <div id="s-col-7" class="chart-set"></div>
                        <span class="badge fw-medium badge-soft-success flex-shrink-0 ms-2" id="cancelled-appointments-change-bottom">--%</span>
                        <p class="ms-1 fs-13 text-truncate">in last 7 Days</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Row -->
    <div class="row mt-4">
        <!-- Next Patient Details -->
        <div class="col-xl-4 d-flex">
            <div class="card shadow-sm flex-fill w-100">
                <div class="card-header d-flex align-items-center justify-content-between">
                    <h5 class="fw-bold mb-0 text-truncate">Upcoming Appointments</h5>
                    <div class="dropdown">
                        <a href="javascript:void(0);" class="btn btn-sm px-2 border shadow-sm btn-outline-white d-inline-flex align-items-center" data-bs-toggle="dropdown">
                            Today <i class="ti ti-chevron-down ms-1"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Today</a></li>
                            <li><a class="dropdown-item" href="#">This Week</a></li>
                            <li><a class="dropdown-item" href="#">This Month</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body" id="next-patient-container">
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status"></div>
                        <p class="mt-2">Loading data...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Today's Appointments -->
        <div class="col-xl-8 d-flex">
            <div class="card shadow-sm flex-fill w-100">
                <div class="card-header d-flex align-items-center justify-content-between">
                    <h5 class="fw-bold mb-0">Appointments</h5>
                    <div class="dropdown">
                        <a href="javascript:void(0);" class="btn btn-sm px-2 border shadow-sm btn-outline-white d-inline-flex align-items-center" data-bs-toggle="dropdown">
                            Monthly <i class="ti ti-chevron-down ms-1"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Monthly</a></li>
                            <li><a class="dropdown-item" href="#">Weekly</a></li>
                            <li><a class="dropdown-item" href="#">Yearly</a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body pb-0">
                    <div class="d-flex align-items-center justify-content-end gap-2 mb-1 flex-wrap mb-3">
                        <p class="mb-0 d-inline-flex align-items-center"><i class="ti ti-point-filled me-1 fs-18 text-primary"></i>Total Appointments</p>
                        <p class="mb-0 d-inline-flex align-items-center"><i class="ti ti-point-filled me-1 fs-18 text-success"></i>Completed Appointments</p>
                    </div>
                    <div class="chart-set" id="s-col-20"></div>
                </div>
            </div>
        </div>
    </div>



  
    <!-- For Recent Appointments Table -->
    <tbody id="recent-appointments-tbody">
        <!-- Dynamic content will be loaded here -->
    </tbody>

    <!-- For Top Patients -->
    <div class="card-body" id="top-patients-container">
        <!-- Dynamic content will be loaded here -->
    </div>

    <!-- For Availability -->
    <div class="card-body" id="availability-container">
        <!-- Dynamic content will be loaded here -->
    </div>

    <!-- For Statistics Numbers -->
    <div class="d-flex align-items-center justify-content-center gap-2 mt-3">
        <div class="text-center">
            <p class="d-flex align-items-center mb-1 fs-13"><i class="ti ti-circle-filled text-success fs-10 me-1"></i>Completed</p>
            <h5 class="fw-bold mb-0" id="completed-count">260</h5>
        </div>
        <div class="text-center">
            <p class="d-flex align-items-center mb-1 fs-13"><i class="ti ti-circle-filled text-warning fs-10 me-1"></i>Pending</p>
            <h5 class="fw-bold mb-0" id="pending-count">21</h5>
        </div>
        <div class="text-center">
            <p class="d-flex align-items-center mb-1 fs-13"><i class="ti ti-circle-filled text-danger fs-10 me-1"></i>Cancelled</p>
            <h5 class="fw-bold mb-0" id="cancelled-count">50</h5>
        </div>
    </div>

    <!-- For Statistics Cards Row -->
    <div class="row row-cols-1 row-cols-xl-6 row-cols-md-3 row-cols-sm-2">
        <div class="col">
            <div class="card shadow-sm">
                <div class="card-body">
                    <span class="avatar bg-primary rounded-2 fs-20 d-inline-flex mb-2"><i class="ti ti-user"></i></span>
                    <p class="mb-1 text-truncate">Total Patient</p>
                    <h3 class="fw-bold mb-2" id="total-patients">658</h3>
                    <p class="mb-0 text-success text-truncate">+31% Last Week</p>
                </div>
            </div>
        </div>
        <!-- Add similar cards for other statistics -->
    </div>

</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Initialize charts first
            initializeCharts();

            // Load all dashboard data
            loadDashboardData();
            loadRecentAppointments();
            loadStatistics();
            loadTopPatients();
            loadAvailability();
            loadAppointmentStatistics();

            // Setup dropdown functionality
            setupDropdownFilters();

            function initializeCharts() {
                // Sparkline chart options for top row cards
                var sparklineOptions = {
                    chart: {
                        type: 'bar',
                        height: 40,
                        sparkline: { enabled: true },
                        animations: { enabled: false }
                    },
                    plotOptions: {
                        bar: {
                            columnWidth: '60%',
                            borderRadius: 2
                        }
                    },
                    tooltip: { enabled: false },
                    grid: { show: false }
                };

                // Initialize top row sparkline charts
                window.appointmentsChart = new ApexCharts(document.querySelector("#s-col-5"), {
                    ...sparklineOptions,
                    series: [{ data: [] }], // Empty initially, will be populated from database
                    colors: ['#0d6efd']
                });

                window.onlineChart = new ApexCharts(document.querySelector("#s-col-6"), {
                    ...sparklineOptions,
                    series: [{ data: [] }], // Empty initially
                    colors: ['#dc3545']
                });

                window.cancelledChart = new ApexCharts(document.querySelector("#s-col-7"), {
                    ...sparklineOptions,
                    series: [{ data: [] }], // Empty initially
                    colors: ['#198754']
                });

                // Main appointments chart - no mock data
                window.appointmentsMainChart = new ApexCharts(document.querySelector("#s-col-20"), {
                    chart: {
                        type: 'area',
                        height: 300,
                        toolbar: { show: false },
                        zoom: { enabled: false },
                        animations: { enabled: false }
                    },
                    series: [], // Empty initially, will be populated from database
                    colors: ['#0d6efd', '#198754'],
                    fill: {
                        type: 'gradient',
                        gradient: {
                            shadeIntensity: 1,
                            opacityFrom: 0.4,
                            opacityTo: 0.1
                        }
                    },
                    stroke: {
                        curve: 'smooth',
                        width: 2
                    },
                    xaxis: {
                        categories: [], // Will be populated from database
                        axisBorder: { show: false },
                        axisTicks: { show: false }
                    },
                    yaxis: { show: false },
                    grid: {
                        show: true,
                        borderColor: '#f1f1f1',
                        strokeDashArray: 3
                    },
                    legend: { show: false },
                    dataLabels: { enabled: false }
                });

                // Appointment Statistics Donut Chart - no mock data
                window.statisticsChart = new ApexCharts(document.querySelector("#circle-chart-2"), {
                    chart: {
                        type: 'donut',
                        height: 200,
                        animations: { enabled: false }
                    },
                    series: [], // Empty initially
                    labels: ['Completed', 'Pending', 'Cancelled'],
                    colors: ['#198754', '#ffc107', '#dc3545'],
                    plotOptions: {
                        pie: {
                            donut: { size: '70%' }
                        }
                    },
                    legend: { show: false },
                    dataLabels: { enabled: false },
                    stroke: { width: 0 }
                });

                // Render all charts
                window.appointmentsChart.render();
                window.onlineChart.render();
                window.cancelledChart.render();
                window.appointmentsMainChart.render();
                window.statisticsChart.render();
            }

            function setupDropdownFilters() {
                $('.dropdown-menu a').on('click', function(e) {
                    e.preventDefault();
                    const filterText = $(this).text();
                    const dropdownToggle = $(this).closest('.dropdown').find('.dropdown-toggle');

                    // Update button text
                    dropdownToggle.html(filterText + ' <i class="ti ti-chevron-down ms-1"></i>');

                    // Handle different filter actions
                    const cardHeader = $(this).closest('.card-header');
                    const cardTitle = cardHeader.find('h5').text();

                    if (cardTitle.includes('Upcoming Appointments')) {
                        loadUpcomingAppointments(filterText.toLowerCase());
                    } else if (cardTitle.includes('Appointments') && !cardTitle.includes('Upcoming')) {
                        loadAppointmentsChart(filterText.toLowerCase());
                    } else if (cardTitle.includes('Recent Appointments')) {
                        loadRecentAppointments(filterText.toLowerCase());
                    } else if (cardTitle.includes('Appointment Statistics')) {
                        loadAppointmentStatistics(filterText.toLowerCase());
                    } else if (cardTitle.includes('Top Patients')) {
                        loadTopPatients(filterText.toLowerCase());
                    }
                });
            }

            function loadDashboardData() {
                $.ajax({
                    url: '/DoctorDashboard/GetData',
                    type: 'GET',
                    success: function(data) {
                        // Update stat numbers from database
                        $('#total-appointments-today').text(data.totalAppointmentsToday);
                        $('#online-consultations-today').text(data.onlineConsultationsToday);
                        $('#cancelled-appointments-today').text(data.cancelledAppointmentsToday);

                        // Update percentage badges from database
                        updateBadge($('#total-appointments-change-top'), data.totalAppointmentsChange, true);
                        updateBadge($('#total-appointments-change-bottom'), data.totalAppointmentsChange, false);
                        updateBadge($('#online-consultations-change-top'), data.onlineConsultationsChange, true);
                        updateBadge($('#online-consultations-change-bottom'), data.onlineConsultationsChange, false);
                        updateBadge($('#cancelled-appointments-change-top'), data.cancelledAppointmentsChange, true);
                        updateBadge($('#cancelled-appointments-change-bottom'), data.cancelledAppointmentsChange, false);

                        // Update sparkline charts with database data
                        if (window.appointmentsChart && data.weeklyAppointmentData) {
                            window.appointmentsChart.updateSeries([{ data: data.weeklyAppointmentData }]);
                        }
                        if (window.onlineChart && data.weeklyOnlineConsultationData) {
                            window.onlineChart.updateSeries([{ data: data.weeklyOnlineConsultationData }]);
                        }
                        if (window.cancelledChart && data.weeklyCancelledData) {
                            window.cancelledChart.updateSeries([{ data: data.weeklyCancelledData }]);
                        }

                        // Update next patient from database
                        updateNextPatient(data.nextPatient);

                        // Load main appointments chart with database data
                        loadAppointmentsChart('monthly');
                    },
                    error: function() {
                        console.error('Failed to load dashboard data');
                        showErrorMessage('Failed to load dashboard data');
                    }
                });
            }

            function loadAppointmentsChart(filter = 'monthly') {
                $.ajax({
                    url: '/DoctorDashboard/GetAppointmentsChart',
                    type: 'GET',
                    data: { filter: filter },
                    success: function(data) {
                        if (window.appointmentsMainChart && data) {
                            // Update chart with database data
                            window.appointmentsMainChart.updateOptions({
                                series: [
                                    {
                                        name: 'Total Appointments',
                                        data: data.totalAppointments || []
                                    },
                                    {
                                        name: 'Completed Appointments',
                                        data: data.completedAppointments || []
                                    }
                                ],
                                xaxis: {
                                    categories: data.categories || []
                                }
                            });
                        }
                    },
                    error: function() {
                        console.error('Failed to load appointments chart data');
                    }
                });
            }

            function loadRecentAppointments(filter = 'weekly') {
                $.ajax({
                    url: '/DoctorDashboard/GetRecentAppointments',
                    type: 'GET',
                    data: { filter: filter },
                    success: function(data) {
                        let html = '';

                        if (data && data.length > 0) {
                            data.forEach(appointment => {
                                const statusClass = getStatusClass(appointment.status);
                                html += `
                                    <tr>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <a href="javascript:void(0);" class="avatar me-2">
                                                    <img src="${appointment.patientImage}" alt="img" class="rounded-circle">
                                                </a>
                                                <div>
                                                    <h6 class="fs-14 mb-1"><a href="javascript:void(0);" class="fw-medium">${appointment.patientName}</a></h6>
                                                    <p class="mb-0 fs-13">${appointment.phoneNumber}</p>
                                                </div>
                                            </div>
                                        </td>
                                        <td>${appointment.appointmentDate}</td>
                                        <td>${appointment.mode}</td>
                                        <td><span class="badge ${statusClass} fw-medium">${appointment.status}</span></td>
                                        <td class="fw-semibold text-dark">$${appointment.consultationFees}</td>
                                        <td>
                                            <a href="javascript:void(0);" class="shadow-sm fs-14 d-inline-flex border rounded-2 p-1 me-1">
                                                <i class="ti ti-calendar-plus"></i>
                                            </a>
                                            <a href="javascript:void(0);" data-bs-toggle="dropdown" class="shadow-sm fs-14 d-inline-flex border rounded-2 p-1">
                                                <i class="ti ti-dots-vertical"></i>
                                            </a>
                                            <ul class="dropdown-menu p-2">
                                                <li><a href="javascript:void(0);" class="dropdown-item d-flex align-items-center"><i class="ti ti-edit me-2"></i>Edit</a></li>
                                                <li><a href="javascript:void(0);" class="dropdown-item d-flex align-items-center"><i class="ti ti-trash me-2"></i>Delete</a></li>
                                            </ul>
                                        </td>
                                    </tr>`;
                            });
                        } else {
                            html = '<tr><td colspan="6" class="text-center py-4">No appointments found</td></tr>';
                        }

                        $('#recent-appointments-tbody').html(html);
                    },
                    error: function() {
                        console.error('Failed to load recent appointments');
                        $('#recent-appointments-tbody').html('<tr><td colspan="6" class="text-center py-4 text-danger">Failed to load appointments</td></tr>');
                    }
                });
            }

            function loadStatistics() {
                $.ajax({
                    url: '/DoctorDashboard/GetStatistics',
                    type: 'GET',
                    success: function(data) {
                        // Update all statistics from database
                        $('#total-patients').text(data.totalPatients || 0);
                        $('#video-consultations').text(data.videoConsultations || 0);
                        $('#rescheduled').text(data.rescheduled || 0);
                        $('#pre-visit-bookings').text(data.preVisitBookings || 0);
                        $('#walkin-bookings').text(data.walkinBookings || 0);
                        $('#follow-ups').text(data.followUps || 0);
                    },
                    error: function() {
                        console.error('Failed to load statistics');
                    }
                });
            }

            function loadTopPatients(filter = 'weekly') {
                $.ajax({
                    url: '/DoctorDashboard/GetTopPatients',
                    type: 'GET',
                    data: { filter: filter },
                    success: function(data) {
                        let html = '';

                        if (data && data.length > 0) {
                            data.forEach(patient => {
                                html += `
                                    <div class="d-flex align-items-center justify-content-between mb-4">
                                        <div class="d-flex align-items-center">
                                            <a href="javascript:void(0);" class="avatar me-2 flex-shrink-0">
                                                <img src="${patient.patientImage}" alt="img" class="rounded-circle">
                                            </a>
                                            <div>
                                                <h6 class="fs-14 mb-1 text-truncate"><a href="javascript:void(0);" class="fw-medium">${patient.patientName}</a></h6>
                                                <p class="mb-0 fs-13 text-truncate">${patient.phoneNumber}</p>
                                            </div>
                                        </div>
                                        <span class="badge fw-medium badge-soft-primary border border-primary flex-shrink-0">${patient.appointmentCount} Appointments</span>
                                    </div>`;
                            });
                        } else {
                            html = '<div class="text-center py-4">No patient data found</div>';
                        }

                        $('#top-patients-container').html(html);
                    },
                    error: function() {
                        console.error('Failed to load top patients');
                        $('#top-patients-container').html('<div class="text-center py-4 text-danger">Failed to load patient data</div>');
                    }
                });
            }

            function loadAvailability() {
                $.ajax({
                    url: '/DoctorDashboard/GetAvailability',
                    type: 'GET',
                    success: function(data) {
                        let html = '';
                        const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

                        days.forEach((day, index) => {
                            const availability = data.find(a => a.dayOfWeek === index + 1);
                            const borderClass = index < 6 ? 'border-bottom pb-2' : 'pb-2';

                            if (availability && availability.isAvailable) {
                                html += `
                                    <div class="d-flex align-items-center justify-content-between mb-2 ${borderClass}">
                                        <p class="text-dark fw-semibold mb-0">${day}</p>
                                        <p class="mb-0 d-inline-flex align-items-center"><i class="ti ti-clock me-1"></i>${availability.startTime} - ${availability.endTime}</p>
                                    </div>`;
                            } else {
                                html += `
                                    <div class="d-flex align-items-center justify-content-between mb-2 ${borderClass}">
                                        <p class="text-dark fw-semibold mb-0">${day}</p>
                                        <p class="mb-0 d-inline-flex align-items-center text-danger"><i class="ti ti-clock me-1"></i>Closed</p>
                                    </div>`;
                            }
                        });

                        html += '<a href="javascript:void(0);" class="btn btn-light w-100 mt-2 fs-13">Edit Availability</a>';
                        $('#availability-container').html(html);
                    },
                    error: function() {
                        console.error('Failed to load availability');
                    }
                });
            }

            function loadAppointmentStatistics(filter = 'monthly') {
                $.ajax({
                    url: '/DoctorDashboard/GetAppointmentStatistics',
                    type: 'GET',
                    data: { filter: filter },
                    success: function(data) {
                        if (window.statisticsChart && data) {
                            // Update donut chart with database data
                            window.statisticsChart.updateSeries([
                                data.completed || 0,
                                data.pending || 0,
                                data.cancelled || 0
                            ]);
                        }

                        // Update statistics numbers from database
                        $('#completed-count').text(data.completed || 0);
                        $('#pending-count').text(data.pending || 0);
                        $('#cancelled-count').text(data.cancelled || 0);
                    },
                    error: function() {
                        console.error('Failed to load appointment statistics');
                    }
                });
            }

            function updateNextPatient(patient) {
                const container = $('#next-patient-container');
                if (patient) {
                    const appointmentDate = new Date(patient.lastAppointmentDate);
                    const html = `
                        <div class="d-flex align-items-center mb-3">
                            <a href="javascript:void(0);" class="avatar me-2 flex-shrink-0">
                                <img src="${patient.profileImage || 'assets/img/doctors/doctor-01.jpg'}" alt="img" class="rounded-circle">
                            </a>
                            <div>
                                <h6 class="fs-14 mb-1 text-truncate"><a href="javascript:void(0);" class="fw-semibold">${patient.fullName}</a></h6>
                                <p class="mb-0 fs-13 text-truncate">#AP${patient.patientId.toString().padStart(6, '0')}</p>
                            </div>
                        </div>
                        <h6 class="fs-14 fw-semibold mb-1">General Visit</h6>
                        <div class="d-flex align-items-center gap-2 flex-wrap mb-3">
                            <p class="mb-0 d-inline-flex align-items-center"><i class="ti ti-calendar-time text-dark me-1"></i>${appointmentDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' })}</p>
                            <p class="mb-0 d-inline-flex align-items-center"><i class="ti ti-clock text-dark me-1"></i>${appointmentDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: true})}</p>
                        </div>
                        <div class="row">
                            <div class="col">
                                <h6 class="fs-13 fw-semibold mb-1">Department</h6>
                                <p>Cardiology</p>
                            </div>
                            <div class="col">
                                <h6 class="fs-13 fw-semibold mb-1">Type</h6>
                                <p class="text-truncate">Online Consultation</p>
                            </div>
                        </div>
                        <div class="my-3 border-bottom pb-3">
                            <a href="javascript:void(0);" class="btn btn-primary w-100">Start Appointment</a>
                        </div>
                        <div class="d-flex align-items-center gap-2">
                            <a href="javascript:void(0);" class="btn btn-dark w-100"><i class="ti ti-brand-hipchat me-1"></i>Chat Now</a>
                            <a href="javascript:void(0);" class="btn btn-outline-white w-100"><i class="ti ti-video me-1"></i>Video Consultation</a>
                        </div>`;
                    container.html(html);
                } else {
                    container.html('<div class="text-center py-5"><i class="ti ti-users-off fs-48 text-muted mb-3"></i><p class="text-muted">No upcoming appointments</p></div>');
                }
            }

            function getStatusClass(status) {
                switch(status.toLowerCase()) {
                    case 'completed': case 'checked out': return 'bg-success';
                    case 'pending': case 'checked in': return 'bg-warning';
                    case 'cancelled': return 'bg-danger';
                    case 'scheduled': return 'bg-info';
                    default: return 'bg-secondary';
                }
            }

            function updateBadge(element, value, isTopBadge) {
                const formattedValue = (value >= 0 ? '+' : '') + Math.abs(value) + '%';
                element.text(formattedValue);

                if (isTopBadge) {
                    element.removeClass('bg-success bg-danger bg-secondary').addClass(value >= 0 ? 'bg-success' : 'bg-danger');
                } else {
                    element.removeClass('badge-soft-success badge-soft-danger').addClass(value >= 0 ? 'badge-soft-success' : 'badge-soft-danger');
                    const arrow = value >= 0 ? '<i class="ti ti-arrow-up ms-1"></i>' : '<i class="ti ti-arrow-down ms-1"></i>';
                    element.html(formattedValue + ' ' + arrow);
                }
            }

            function showErrorMessage(message) {
                console.error(message);
                // You can implement toast notifications here
            }
        });

    </script>
}
