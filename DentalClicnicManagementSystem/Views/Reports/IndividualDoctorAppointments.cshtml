@* File: Views/Reports/IndividualDoctorAppointments.cshtml *@
@{
    ViewData["Title"] = "Individual Doctor Appointments";
}

<div class="content">
    <div class="d-flex align-items-sm-center flex-sm-row flex-column gap-2 mb-3 pb-3 border-bottom">
        <div class="flex-grow-1">
            <h4 class="fw-bold mb-0">Individual Doctor Appointments</h4>
        </div>
        <div class="text-end d-flex">
            <div class="dropdown me-1">
                <a href="javascript:void(0);" class="btn btn-md fs-14 fw-normal border bg-white rounded text-dark d-inline-flex align-items-center" data-bs-toggle="dropdown">
                    Export <i class="ti ti-chevron-down ms-2"></i>
                </a>
                <ul class="dropdown-menu p-2">
                    <li><a class="dropdown-item export-csv" href="javascript:void(0);" data-report="doctorappointments">Download as CSV</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Doctor Selection -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row row-gap-2">
                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Select Doctor</label>
                        <select class="form-select" id="doctorFilter">
                            <option value="">Select a Doctor</option>
                            <option value="1">Dr. Sarah Wilson</option>
                            <option value="2">Dr. Michael Chen</option>
                            <option value="3">Dr. James Miller</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="startDate" value="@DateTime.Today.AddDays(-7).ToString("yyyy-MM-dd")">
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="mb-3">
                        <label class="form-label">End Date</label>
                        <input type="date" class="form-control" id="endDate" value="@DateTime.Today.ToString("yyyy-MM-dd")">
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="mb-3 d-flex align-items-end">
                        <button type="button" class="btn btn-dark w-100" id="applyFiltersBtn">
                            <i class="ti ti-player-play me-1"></i>Run Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Doctor Summary -->
    <div id="doctorSummary" class="row mb-4" style="display: none;">
        <div class="col-xl-3 col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="mb-1">Total Appointments</p>
                            <h4 class="mb-0 fw-bold text-primary" id="totalAppointments">0</h4>
                        </div>
                        <span class="avatar avatar-md bg-soft-primary text-primary rounded-2">
                            <i class="ti ti-calendar fs-18"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="mb-1">Completed</p>
                            <h4 class="mb-0 fw-bold text-success" id="completedAppointments">0</h4>
                        </div>
                        <span class="avatar avatar-md bg-soft-success text-success rounded-2">
                            <i class="ti ti-check fs-18"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="mb-1">Cancelled</p>
                            <h4 class="mb-0 fw-bold text-danger" id="cancelledAppointments">0</h4>
                        </div>
                        <span class="avatar avatar-md bg-soft-danger text-danger rounded-2">
                            <i class="ti ti-x fs-18"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <p class="mb-1">No Show</p>
                            <h4 class="mb-0 fw-bold text-warning" id="noShowAppointments">0</h4>
                        </div>
                        <span class="avatar avatar-md bg-soft-warning text-warning rounded-2">
                            <i class="ti ti-user-off fs-18"></i>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Table -->
    <div class="card">
        <div class="card-body">
            <div id="appointmentsTableContainer" style="display: none;">
                <h5 class="mb-3" id="doctorNameHeader"></h5>
                <div class="table-responsive">
                    <table class="table table-hover" id="appointmentsTable">
                        <thead class="thead-light">
                            <tr>
                                <th>Date & Time</th>
                                <th>Patient</th>
                                <th>Treatment</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Data will be loaded via AJAX -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="noDataMessage" class="text-center py-5">
                <i class="ti ti-user-search fs-48 text-muted mb-3"></i>
                <h5 class="text-muted">Please select a doctor to view appointments</h5>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            // Apply filters
            $('#applyFiltersBtn').on('click', function () {
                const doctorId = $('#doctorFilter').val();
                if (!doctorId) {
                    alert('Please select a doctor');
                    return;
                }
                loadDoctorAppointmentsData();
            });

            function loadDoctorAppointmentsData() {
                const params = getFilterParams();
                const doctorName = $('#doctorFilter option:selected').text();

                // For demo purposes - replace with actual API call
                const demoData = getDemoDoctorAppointmentsData();
                showDoctorSummary(doctorName, demoData.summary);
                populateAppointmentsTable(demoData.data);
            }

            function getFilterParams() {
                return {
                    doctorId: $('#doctorFilter').val(),
                    startDate: $('#startDate').val(),
                    endDate: $('#endDate').val()
                };
            }

            function showDoctorSummary(doctorName, summary) {
                $('#doctorNameHeader').text(`Appointments for ${doctorName}`);
                $('#totalAppointments').text(summary.totalAppointments);
                $('#completedAppointments').text(summary.completedAppointments);
                $('#cancelledAppointments').text(summary.cancelledAppointments);
                $('#noShowAppointments').text(summary.noShowAppointments);

                $('#doctorSummary').show();
                $('#appointmentsTableContainer').show();
                $('#noDataMessage').hide();
            }

            function populateAppointmentsTable(data) {
                const tbody = $('#appointmentsTable tbody');
                tbody.empty();

                if (data.length === 0) {
                    tbody.append('<tr><td colspan="6" class="text-center">No appointments found for the selected period</td></tr>');
                    return;
                }

                data.forEach(function (item) {
                    const statusBadge = getStatusBadge(item.status);
                    const row = `
                        <tr>
                            <td>
                                <div class="fw-bold">${item.date}</div>
                                <small class="text-muted">${item.time}</small>
                            </td>
                            <td><strong>${item.patientName}</strong></td>
                            <td>${item.treatment}</td>
                            <td>${item.duration} min</td>
                            <td><span class="badge bg-${statusBadge}">${item.status}</span></td>
                            <td class="truncate-220">${item.notes || '-'}</td>
                        </tr>
                    `;
                    tbody.append(row);
                });
            }

            function getStatusBadge(status) {
                switch(status) {
                    case 'Completed': return 'success';
                    case 'Scheduled': return 'primary';
                    case 'Cancelled': return 'danger';
                    case 'No Show': return 'warning';
                    default: return 'secondary';
                }
            }

            // Demo data function
            function getDemoDoctorAppointmentsData() {
                return {
                    summary: {
                        totalAppointments: 18,
                        completedAppointments: 15,
                        cancelledAppointments: 2,
                        noShowAppointments: 1
                    },
                    data: [
                        {
                            date: '@DateTime.Today.ToString("yyyy-MM-dd")',
                            time: '09:00 AM',
                            patientName: 'John Smith',
                            treatment: 'Dental Checkup',
                            duration: 30,
                            status: 'Completed',
                            notes: 'Regular checkup, teeth cleaning'
                        },
                        {
                            date: '@DateTime.Today.ToString("yyyy-MM-dd")',
                            time: '10:30 AM',
                            patientName: 'Sarah Johnson',
                            treatment: 'Tooth Filling',
                            duration: 45,
                            status: 'Completed',
                            notes: 'Cavity filling on molar'
                        },
                        {
                            date: '@DateTime.Today.ToString("yyyy-MM-dd")',
                            time: '02:00 PM',
                            patientName: 'Mike Brown',
                            treatment: 'Root Canal',
                            duration: 90,
                            status: 'Scheduled',
                            notes: 'Follow-up appointment'
                        }
                    ]
                };
            }
        });
    </script>
}